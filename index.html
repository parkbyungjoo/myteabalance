<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tea Therapy</title>
    <!-- SEO Meta Tags -->
    <meta name="description"
        content="Discover your innate elemental rhythm (Saju/Myungrihak) and find personalized tea recommendations for vitality, stress relief, and holistic balance. Optimized for US births with auto-DST calculation.">
    <meta name="keywords"
        content="Tea Therapy, Myungrihak, Saju, 8 Pillars, Herbal Tea, Holistic Health, Vitality, Oriental Medicine, Energy Balance, Stress Relief, Wellness, Meditation Tea, Asian Wisdom, Constitution Analysis">
    <meta name="author" content="Dr. Byungjoo Park">

    <!-- Open Graph (Social Sharing) -->
    <meta property="og:title" content="Tea Therapy">
    <meta property="og:description"
        content="Analyze your birth energy pattern based on natural statistics and find the perfect tea to harmonize your body and mind.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ricecakeusa.com/"> <!-- Assuming hosted here or placeholder -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;600&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fdfcf9;
        }

        .serif {
            font-family: 'Playfair Display', serif;
        }

        .pillar-card {
            background: white;
            border-radius: 12px;
            padding: 15px 5px;
            border: 1px solid #e5e7eb;
        }

        .highlight {
            border: 2px solid #065f46;
            background-color: #f0fdf4;
        }

        .btn-active {
            background-color: #065f46;
            color: white;
            border-color: #065f46;
        }
    </style>
</head>

<body class="bg-stone-50 text-stone-800 antialiased min-h-screen flex flex-col font-sans selection:bg-stone-200">

    <!-- Hero Section -->
    <div class="relative w-full overflow-hidden bg-stone-900 text-stone-100 shadow-2xl pb-16">
        <div class="absolute top-0 left-0 w-full h-full opacity-20 pointer-events-none"
            style="background: radial-gradient(circle at 50% 50%, #57534e 0%, #1c1917 100%);"></div>
        <div class="max-w-xl mx-auto px-6 py-16 relative z-10 text-center">
            <span
                class="text-amber-400 font-bold tracking-[0.3em] uppercase text-xs mb-4 block animate-in fade-in slide-in-from-bottom-4 duration-700">Oriental
                Wisdom</span>
            <h1
                class="serif text-4xl md:text-6xl font-medium mb-6 animate-in fade-in slide-in-from-bottom-6 duration-1000 delay-100 leading-tight">
                Life Energy<br /><span class="italic text-stone-400 text-3xl md:text-5xl">& Vitality
                    Analysis</span>
            </h1>
            <p
                class="text-stone-400 text-sm md:text-base mb-10 leading-relaxed max-w-md mx-auto animate-in fade-in slide-in-from-bottom-8 duration-1000 delay-200">
                Your unique elemental pattern is determined by the specific Year, Month, Day, and Hour of your birth.
                Discover your innate rhythm and the perfect tea to harmonize your energy.
            </p>

            <!-- Input Card -->
            <div
                class="bg-white/5 backdrop-blur-xl p-8 rounded-[30px] border border-white/10 shadow-2xl animate-in fade-in zoom-in duration-700 delay-300">
                <div class="space-y-6 text-left">
                    <div>
                        <label
                            class="block text-xs uppercase tracking-widest text-stone-400 mb-2 font-semibold ml-1">Date
                            of Birth</label>
                        <input type="date" id="date"
                            class="w-full bg-stone-800/50 border border-stone-700 rounded-2xl px-5 py-4 text-stone-100 focus:outline-none focus:border-amber-500 focus:ring-1 focus:ring-amber-500 transition shadow-inner text-lg font-medium">
                    </div>

                    <div>
                        <div class="flex justify-between items-end mb-2">
                            <label
                                class="block text-xs uppercase tracking-widest text-stone-400 font-semibold ml-1">Birth
                                Time (U.S. Local)</label>
                            <span id="dstStatus"
                                class="hidden text-[10px] bg-amber-500/20 text-amber-300 px-2 py-0.5 rounded-full border border-amber-500/30">Auto
                                DST Applied</span>
                        </div>
                        <input type="time" id="time"
                            class="w-full bg-stone-800/50 border border-stone-700 rounded-2xl px-5 py-4 text-stone-100 focus:outline-none focus:border-amber-500 focus:ring-1 focus:ring-amber-500 transition shadow-inner text-lg font-medium">
                        <p class="text-[10px] text-stone-500 mt-2 ml-1 leading-relaxed">
                            * You can find the time recorded on your <b class="text-stone-400">Birth
                                Certificate</b>.
                        </p>
                    </div>

                    <button onclick="calculate()"
                        class="w-full bg-gradient-to-r from-amber-700 to-amber-600 hover:from-amber-600 hover:to-amber-500 text-white font-bold py-4 rounded-2xl shadow-lg transform transition hover:scale-[1.02] active:scale-[0.98] duration-200 text-lg tracking-wide border border-amber-500/20">
                        Analyze My Energy
                    </button>


                </div>
            </div>

        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-4xl mx-auto px-6 -mt-8 relative z-20 pb-20">
        <!-- Life Energy Profile Card -->
        <div class="hidden mt-12 animate-in fade-in slide-in-from-bottom-4 duration-700" id="pillarDisplay">
            <div class="bg-white rounded-3xl shadow-xl p-6 md:p-8 border border-stone-200">
                <h2 class="serif text-2xl md:text-3xl text-stone-800 text-center mb-6 tracking-wide">
                    Your Life Energy Profile
                </h2>
                <div class="grid grid-cols-4 gap-2 md:gap-4 text-center">
                    <div class="space-y-2">
                        <span
                            class="text-[10px] uppercase tracking-widest text-stone-400 font-bold block mb-1">Hour</span>
                        <div id="hP" class="space-y-1 font-medium text-sm md:text-base"></div>
                    </div>
                    <div class="space-y-2">
                        <span
                            class="text-[10px] uppercase tracking-widest text-stone-400 font-bold block mb-1">Day</span>
                        <div id="dP" class="space-y-1 font-medium text-sm md:text-base"></div>
                    </div>
                    <div class="space-y-2">
                        <span
                            class="text-[10px] uppercase tracking-widest text-stone-400 font-bold block mb-1">Month</span>
                        <div id="mP" class="space-y-1 font-medium text-sm md:text-base"></div>
                    </div>
                    <div class="space-y-2">
                        <span
                            class="text-[10px] uppercase tracking-widest text-stone-400 font-bold block mb-1">Year</span>
                        <div id="yP" class="space-y-1 font-medium text-sm md:text-base"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Result Area (Hidden by Default) -->
        <div id="resultArea"
            class="hidden mt-8 w-full animate-in fade-in zoom-in duration-500 rounded-[50px] p-8 md:p-12 text-white relative shadow-2xl overflow-hidden min-h-[600px] flex flex-col justify-center transform transition-colors duration-1000">
            <!-- Decorative Elements -->
            <div
                class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none bg-[radial-gradient(circle_at_top_right,_var(--tw-gradient-stops))] from-white via-transparent to-transparent">
            </div>

            <div class="relative z-10 text-center space-y-8">
                <div>
                    <h2 class="text-xs uppercase tracking-[0.3em] opacity-80 mb-4 font-semibold">Your Balancing Element
                    </h2>
                    <div id="targetElement" class="text-4xl md:text-6xl serif font-medium mb-4 drop-shadow-md"></div>
                    <div id="elementCounts"
                        class="flex flex-wrap justify-center gap-3 text-[10px] uppercase tracking-widest opacity-70">
                    </div>
                </div>

                <div class="w-16 h-px bg-white/30 mx-auto"></div>

                <p id="analysisDesc"
                    class="text-lg md:text-xl leading-relaxed text-white/90 font-light max-w-2xl mx-auto"></p>

                <div
                    class="bg-white/10 backdrop-blur-md rounded-3xl p-8 border border-white/10 shadow-inner max-w-lg mx-auto transform hover:scale-[1.01] transition duration-300">
                    <h3 class="serif text-2xl mb-6">Recommended Teas</h3>
                    <div class="space-y-6 text-left">
                        <!-- Tea 1 -->
                        <div class="flex flex-col gap-2">
                            <div class="flex items-center justify-between gap-4">
                                <div class="flex items-center gap-2">
                                    <div class="bg-white/20 p-2 rounded-full">üåø</div>
                                    <h4 id="tea1Name" class="font-bold text-lg text-white"></h4>
                                </div>
                                <a id="tea1Link" href="#" target="_blank"
                                    class="px-3 py-1.5 bg-white text-stone-900 rounded-full text-[10px] font-bold uppercase tracking-wider hover:bg-stone-200 transition shadow-sm whitespace-nowrap">
                                    Shop Tea
                                </a>
                            </div>
                            <p id="tea1Desc" class="text-sm text-white/80 leading-relaxed pl-12"></p>
                        </div>

                        <div class="h-px bg-white/10 w-full"></div>

                        <!-- Tea 2 -->
                        <div class="flex flex-col gap-2">
                            <div class="flex items-center justify-between gap-4">
                                <div class="flex items-center gap-2">
                                    <div class="bg-white/20 p-2 rounded-full">üçµ</div>
                                    <h4 id="tea2Name" class="font-bold text-lg text-white"></h4>
                                </div>
                                <a id="tea2Link" href="#" target="_blank"
                                    class="px-3 py-1.5 bg-white text-stone-900 rounded-full text-[10px] font-bold uppercase tracking-wider hover:bg-stone-200 transition shadow-sm whitespace-nowrap">
                                    Shop Tea
                                </a>
                            </div>
                            <p id="tea2Desc" class="text-sm text-white/80 leading-relaxed pl-12"></p>
                        </div>
                    </div>
                </div>

                <div class="bg-white/5 backdrop-blur-sm rounded-2xl p-6 border border-white/5 max-w-lg mx-auto">
                    <h4 class="font-bold text-xs uppercase tracking-widest mb-3 opacity-90">Luck Boosting Tip</h4>
                    <p id="lifestyleTip" class="text-sm text-white/80 leading-relaxed"></p>
                </div>

                <div class="pt-4 flex flex-col md:flex-row gap-4 justify-center">
                    <a id="toolLink" href="#" target="_blank"
                        class="inline-block bg-white text-stone-900 px-8 py-4 rounded-full font-bold text-sm hover:bg-stone-100 transition shadow-lg transform hover:scale-105 duration-200 border border-transparent">
                        Shop Tea Ritual Tools ‚Üí
                    </a>
                </div>
            </div>
        </div>


        <!-- General Analysis Section -->
        <div id="genAnalysisArea"
            class="hidden mt-8 w-full animate-in slide-in-from-bottom-10 fade-in duration-1000 delay-300">
            <div
                class="bg-stone-950 text-stone-300 rounded-[40px] p-8 md:p-12 shadow-2xl border border-stone-800 relative overflow-hidden">
                <!-- Background Pattern -->
                <div
                    class="absolute top-0 right-0 w-64 h-64 bg-amber-900/10 rounded-full blur-[100px] pointer-events-none">
                </div>

                <h3 class="serif text-3xl text-amber-500 text-center mb-10 tracking-wide">Detailed Pattern Analysis</h3>

                <div class="space-y-8">
                    <!-- Personality -->
                    <div
                        class="bg-stone-900/50 rounded-2xl p-6 md:p-8 border border-stone-800 hover:border-amber-900/30 transition duration-500">
                        <div class="flex items-center gap-4 mb-4">
                            <span class="bg-stone-800 p-3 rounded-full text-xl shadow-inner text-amber-500">üß†</span>
                            <h4 class="font-bold text-stone-100 text-lg tracking-wide uppercase text-xs">Core
                                Personality
                            </h4>
                        </div>
                        <p id="genPersonality" class="text-stone-400 leading-relaxed text-sm md:text-base"></p>
                    </div>

                    <!-- Life Stages -->
                    <div>
                        <h4 class="text-center text-xs uppercase tracking-[0.3em] text-stone-500 mb-6 font-bold">
                            Seasonal
                            Life Flow</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div
                                class="bg-stone-900/50 rounded-2xl p-6 border border-stone-800 hover:bg-stone-900 transition">
                                <h4 class="font-bold text-amber-700 text-xs uppercase tracking-widest mb-2">Early Years
                                    (0-19)</h4>
                                <p id="genYear" class="text-xs text-stone-400 leading-loose"></p>
                            </div>
                            <div
                                class="bg-stone-900/50 rounded-2xl p-6 border border-stone-800 hover:bg-stone-900 transition">
                                <h4 class="font-bold text-amber-700 text-xs uppercase tracking-widest mb-2">Youth
                                    (20-39)
                                </h4>
                                <p id="genMonth" class="text-xs text-stone-400 leading-loose"></p>
                            </div>
                            <div
                                class="bg-stone-900/50 rounded-2xl p-6 border border-stone-800 hover:bg-stone-900 transition">
                                <h4 class="font-bold text-amber-700 text-xs uppercase tracking-widest mb-2">Middle Age
                                    (40-59)</h4>
                                <p id="genDay" class="text-xs text-stone-400 leading-loose"></p>
                            </div>
                            <div
                                class="bg-stone-900/50 rounded-2xl p-6 border border-stone-800 hover:bg-stone-900 transition">
                                <h4 class="font-bold text-amber-700 text-xs uppercase tracking-widest mb-2">Late Years
                                    (60+)
                                </h4>
                                <p id="genHour" class="text-xs text-stone-400 leading-loose"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Wealth & Career -->
                    <div
                        class="bg-gradient-to-br from-stone-900 to-stone-950 rounded-2xl p-6 md:p-8 border border-amber-900/20 shadow-lg relative overflow-hidden">
                        <div
                            class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-amber-700 to-transparent opacity-50">
                        </div>
                        <div class="flex items-center gap-4 mb-4">
                            <span class="bg-black/30 p-3 rounded-full text-xl shadow-inner text-amber-500">üíº</span>
                            <h4 class="font-bold text-stone-100 text-lg tracking-wide uppercase text-xs">Social & Career
                                Potential</h4>
                        </div>
                        <div id="genWealth" class="text-stone-400 leading-relaxed text-sm md:text-base space-y-2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Footer / Profile Area -->
    <footer class="bg-gray-50 text-center py-12 border-t border-gray-100">
        <div class="max-w-2xl mx-auto px-6">
            <h3 class="serif text-2xl text-gray-800 mb-6 font-bold">About the Creator</h3>
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-gray-100">
                <p class="font-bold text-lg text-gray-900 mb-2">Dr. Byungjoo Park</p>
                <div class="space-y-2 text-sm text-gray-600 leading-relaxed">
                    <p>Ph.D. in Metallurgical Engineering, Yonsei University</p>
                    <p>Former Research Fellow, National Institute for Materials Science (NIMS), Japan</p>
                    <p>Licensed Acupuncturist, California</p>
                    <p>Registered Patent Agent, USPTO</p>
                    <p class="pt-2 text-gray-500 italic">Father of Peter Park and Sophia Park, the youngest bar exam
                        passers in California history.</p>
                </div>
            </div>
            <p class="text-xs text-gray-400 mt-8 uppercase tracking-widest">¬© 2026 Dr. Byungjoo Park. All Rights
                Reserved.</p>
        </div>
    </footer>

    <script>
        const GAN = ["Wood +", "Wood -", "Fire +", "Fire -", "Earth +", "Earth -", "Metal +", "Metal -", "Water +", "Water -"];
        const ZHI = ["Mouse", "Ox", "Tiger", "Rabbit", "Dragon", "Snake", "Horse", "Sheep", "Monkey", "Rooster", "Dog", "Pig"];
        const GAN_EL = ["Wood", "Wood", "Fire", "Fire", "Earth", "Earth", "Metal", "Metal", "Water", "Water"];
        const ZHI_EL = ["Water", "Earth", "Wood", "Wood", "Earth", "Fire", "Fire", "Earth", "Metal", "Metal", "Earth", "Water"];

        // Dynamic Theme Colors for Result Area
        const THEME_COLORS = {
            "Wood": { bg: "bg-green-900", accent: "text-green-600", badge: "bg-green-600" },
            "Fire": { bg: "bg-red-900", accent: "text-red-500", badge: "bg-red-600" },
            "Earth": { bg: "bg-amber-900", accent: "text-amber-600", badge: "bg-amber-600" },
            "Metal": { bg: "bg-slate-800", accent: "text-slate-500", badge: "bg-slate-500" },
            "Water": { bg: "bg-blue-950", accent: "text-blue-600", badge: "bg-blue-600" }
        };

        // Interpretation Data (Refined with Positive Language)
        const DM_DESC = [
            "Like a tall pine tree, you are straight-forward, dependable, and have strong leadership qualities. You are principled and protective of your people.", // Áî≤ Yang Wood
            "Like a flexible vine or flower, you are adaptable, gentle, and strategic. You have a resilient spirit that thrives in changing environments.", // ‰πô Yin Wood
            "Like the sun, you are passionate, generous, and visible. You have a warm presence that naturally attracts attention and energizes others.", // ‰∏ô Yang Fire
            "Like a candlelight, you are focused, detail-oriented, and thoughtful. You possess a warm inner heart and deep dedication.", // ‰∏Å Yin Fire
            "Like a mountain, you are trustworthy, stable, and have a heavy, grounding presence. You hold secrets well and are deeply reliable.", // Êàä Yang Earth
            "Like garden soil, you are nurturing, productive, and multi-talented. You excel at cultivating potential in yourself and others.", // Â∑± Yin Earth
            "Like a sword or raw iron, you are decisive, just, and hold high standards. You value loyalty and have the courage to take action.", // Â∫ö Yang Metal
            "Like jewelry or a gemstone, you are delicate, precise, and have a refined taste. You shine brightest when you are appreciated and polished.", // Ëæõ Yin Metal
            "Like the ocean, you are vast, intelligent, and adaptable. You possess great depth and wisdom that allows you to handle any situation.", // Â£¨ Yang Water
            "Like rain or mist, you are gentle, intuitive, and quiet. You have a persistent nature that influences surroundings softly but effectively." // Áô∏ Yin Water
        ];

        const ELEMENT_LIFE_DESC = {
            "Wood": "growth, creativity, and new beginnings. This period fosters curiosity and a drive to explore.",
            "Fire": "passion, expression, and visibility. This is a time of high energy and social expansion.",
            "Earth": "stability, trust, and grounding. A period for building solid foundations and connecting with others.",
            "Metal": "discipline, structure, and refinement. A time for sharpening skills and establishing order.",
            "Water": "wisdom, adaptability, and flow. A period of deep learning, introspection, and flexibility."
        };

        const ELEMENT_WEALTH_ADVICE = {
            "Wood": "Growth & Planning. You profit from new ventures, education, design, or textiles. Consistency and long-term vision bring you fortune.",
            "Fire": "Passion & Media. You thrive in technology, energy, entertainment, or marketing. Fast-paced environments and visibility boost your income.",
            "Earth": "Assets & Trust. Real estate, banking, farming, or consulting suits you. Building trust and holding physical assets secures your wealth.",
            "Metal": "Precision & Systems. Finance, law, engineering, or management are your goldmines. Efficiency and decisiveness are your money-makers.",
            "Water": "Flow & Trade. Logistics, travel, sales, or communication are key. Adaptability and networking bring you financial success."
        };

        const ELEMENT_CAREER_ADVICE = {
            "Wood": "Benevolence & Expansion. Leadership roles that involve teaching, creating, or nurturing growth suit you best.",
            "Fire": "Courtesy & Radiance. Roles requiring presentation, public speaking, or innovation allow you to shine.",
            "Earth": "Trust & Stability. Roles requiring confidentiality, reliability, and mediation make you indispensable.",
            "Metal": "Justice & Order. Roles requiring judgment, execution, or systematic organization utilize your strengths.",
            "Water": "Wisdom & Strategy. Roles requiring deep thinking, research, or negotiation allow your fluid intelligence to work."
        };

        // Background Colors for Pillars (Solid boxes)
        const EL_BG_COLORS = {
            "Wood": "bg-green-600 text-white border-green-700",
            "Fire": "bg-red-500 text-white border-red-600",
            "Earth": "bg-amber-500 text-white border-amber-600",
            "Metal": "bg-slate-400 text-white border-slate-500",
            "Water": "bg-blue-800 text-white border-blue-900"
        };
        const ELEMENT_COLOR_NAME = {
            "Wood": "Green", "Fire": "Red", "Earth": "Yellow/Brown", "Metal": "White/Silver", "Water": "Black/Blue"
        };
        const ELEMENT_WALLPAPER_DESC = {
            "Wood": "a landscape filled with fresh green forests",
            "Fire": "an image rich in warm red and bright colors",
            "Earth": "a landscape with golden earth or mountain tones",
            "Metal": "a clean, minimalist background with white or silver",
            "Water": "an image featuring deep blue waters or night scenery"
        };

        // Add Event Listener to auto-check DST on date change
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('date').addEventListener('change', checkDSTandUpdateUI);
        });

        // --- US DST Logic (Historical) ---
        function getNthSunday(year, month, n) {
            const date = new Date(year, month - 1, 1);
            const day = date.getDay();
            const diff = (day === 0 ? 0 : 7 - day) + (n - 1) * 7;
            return 1 + diff;
        }

        function getLastSunday(year, month) {
            const date = new Date(year, month, 0);
            const day = date.getDay();
            return date.getDate() - day;
        }

        function isUSDST(dateStr) {
            if (!dateStr) return false;
            const date = new Date(dateStr); // Local date from input string
            const y = date.getFullYear();
            const m = date.getMonth() + 1;
            const d = date.getDate();

            // Create a comparable value for current date: MMDD
            // (Assumes simplistic comparison, precise date object comparison is better for ranges)
            const current = new Date(y, m - 1, d);

            // 1. WWII War Time (Year-round DST): Feb 9, 1942 - Sept 30, 1945
            const warStart = new Date(1942, 1, 9); // Feb 9
            const warEnd = new Date(1945, 8, 30);  // Sept 30
            if (current >= warStart && current <= warEnd) return true;

            // 2. WWI DST (1918-1919)
            if (y === 1918) {
                // Mar 31 - Oct 27
                const start = new Date(1918, 2, 31);
                const end = new Date(1918, 9, 27);
                return current >= start && current < end;
            }
            if (y === 1919) {
                // Mar 30 - Oct 26
                const start = new Date(1919, 2, 30);
                const end = new Date(1919, 9, 26);
                return current >= start && current < end;
            }

            // 3. 1946-1965: No federal standard (Assumed Standard Time for simplicity as per request context)
            if (y < 1966 && y > 1945) return false;

            // 4. Uniform Time Act Rules
            let startM, startD, endM, endD;

            if (y >= 2007) {
                // 2007+: 2nd Sun March - 1st Sun Nov
                startM = 3; startD = getNthSunday(y, 3, 2);
                endM = 11; endD = getNthSunday(y, 11, 1);
            } else if (y >= 1987) {
                // 1987-2006: 1st Sun April - Last Sun Oct
                startM = 4; startD = getNthSunday(y, 4, 1);
                endM = 10; endD = getLastSunday(y, 10);
            } else if (y >= 1966) {
                // 1966-1986: Last Sun April - Last Sun Oct
                startM = 4; startD = getLastSunday(y, 4);
                endM = 10; endD = getLastSunday(y, 10);
            } else {
                // Before 1918 or undefined periods -> Default Standard
                return false;
            }

            // Compare for Standard periods
            // Start Date (02:00 am - effectively start of day for this boolean check)
            const dstStart = new Date(y, startM - 1, startD);
            const dstEnd = new Date(y, endM - 1, endD);

            return current >= dstStart && current < dstEnd;
        }

        function checkDSTandUpdateUI() {
            const dateVal = document.getElementById('date').value;
            const statusDiv = document.getElementById('dstStatus');
            if (isUSDST(dateVal)) {
                statusDiv.innerText = "Auto DST Applied";
                statusDiv.classList.remove('hidden');
            } else {
                statusDiv.classList.add('hidden');
            }
        }

        function getPillarHtml(ganIdx, zhiIdx) {
            const ganEl = GAN_EL[ganIdx];
            const zhiEl = ZHI_EL[zhiIdx];
            // Render as colored boxes with English text without text coloring
            return `
                <div class="w-full py-1.5 rounded ${EL_BG_COLORS[ganEl]} border shadow-sm">${GAN[ganIdx]}</div>
                <div class="w-full py-1.5 rounded ${EL_BG_COLORS[zhiEl]} border shadow-sm">${ZHI[zhiIdx]}</div>
            `;
        }

        // Helper to colorize element keywords in text
        function highlightKeywords(text) {
            if (!text) return "";
            return text
                .replace(/\bWood\b/g, '<span class="font-bold text-green-600">Wood</span>')
                .replace(/\bFire\b/g, '<span class="font-bold text-red-600">Fire</span>')
                .replace(/\bEarth\b/g, '<span class="font-bold text-amber-600">Earth</span>')
                .replace(/\bMetal\b/g, '<span class="font-bold text-slate-500">Metal</span>')
                .replace(/\bWater\b/g, '<span class="font-bold text-blue-600">Water</span>');
        }

        function getGenAnalysis(dG, dZ, yG, mG, hG, counts) {
            const myEl = GAN_EL[dG];
            // Simple Relationship Logic
            const elMap = ["Wood", "Fire", "Earth", "Metal", "Water"];
            const myIdx = elMap.indexOf(myEl);

            // Wealth: Element I Control (My Index + 2)
            const wealthIdx = (myIdx + 2) % 5;
            const wealthEl = elMap[wealthIdx];

            // Career: Element Controlling Me (My Index - 2 or + 3)
            const careerIdx = (myIdx + 3) % 5;
            const careerEl = elMap[careerIdx];

            return {
                personality: highlightKeywords(DM_DESC[dG]),
                wealth: `
                    <div class="mb-6">
                        <h5 class="text-amber-500 font-bold uppercase text-[10px] tracking-widest mb-2">üí∞ Money Source (Wealth Element)</h5>
                        <p class="mb-1 text-white"><b>Target: ${highlightKeywords(wealthEl)}</b></p>
                        <p class="text-sm text-stone-400 mb-2">${highlightKeywords(ELEMENT_WEALTH_ADVICE[wealthEl])}</p>
                        <p class="text-xs text-amber-500/80 mt-2 italic">
                            ${counts[wealthEl] > 0 ? "‚úÖ You have this asset naturally. Use it!" : "üí° <b>Strategy:</b> This is weak in your chart. Intentionally seek this element to boost income."}
                        </p>
                    </div>

                    <div>
                        <h5 class="text-amber-500 font-bold uppercase text-[10px] tracking-widest mb-2">üèÜ Social Status (Career Element)</h5>
                        <p class="mb-1 text-white"><b>Target: ${highlightKeywords(careerEl)}</b></p>
                        <p class="text-sm text-stone-400 mb-2">${highlightKeywords(ELEMENT_CAREER_ADVICE[careerEl])}</p>
                        <p class="text-xs text-amber-500/80 mt-2 italic">
                            ${counts[careerEl] > 0 ? "‚úÖ You have this authority naturally. Build your reputation!" : "üí° <b>Strategy:</b> This is weak. You must <i>borrow</i> this energy. Working in these fields or partnering with such people is your ladder to success."}
                        </p>
                    </div>
                `,
                yearDesc: `Your roots are colored by <b>${highlightKeywords(GAN_EL[yG])}</b> energy, characterizing your early years with ${highlightKeywords(ELEMENT_LIFE_DESC[GAN_EL[yG]])}`,
                monthDesc: `Your youth and social environment are influenced by <b>${highlightKeywords(GAN_EL[mG])}</b>, bringing a theme of ${highlightKeywords(ELEMENT_LIFE_DESC[GAN_EL[mG]])}`,
                dayDesc: `Your mature self is grounded in <b>${highlightKeywords(GAN_EL[dG])}</b>, emphasizing ${highlightKeywords(ELEMENT_LIFE_DESC[GAN_EL[dG]])}`,
                hourDesc: `Your later years and legacy reflect <b>${highlightKeywords(GAN_EL[hG])}</b> qualities, suggesting a time of ${highlightKeywords(ELEMENT_LIFE_DESC[GAN_EL[hG]])}`
            };
        }

        function calculate() {
            const dateStr = document.getElementById('date').value;
            const timeStr = document.getElementById('time').value;
            // Auto-detect instead of manual check
            const applyCorrection = isUSDST(dateStr);

            if (!dateStr || !timeStr) {
                alert("Please enter birth date and time");
                return;
            }

            let [hour, min] = timeStr.split(':').map(Number);
            if (applyCorrection) {
                hour -= 1;
                if (hour < 0) {
                    hour += 24;
                }
            }

            const birth = new Date(dateStr);
            const y = birth.getFullYear(), m = birth.getMonth() + 1, d = birth.getDate();

            let yIdx = (y - 4) % 60;
            if (m < 2 || (m === 2 && d < 4)) yIdx--;
            const yG = yIdx % 10, yZ = yIdx % 12;

            const termDays = [0, 5, 4, 6, 5, 6, 6, 7, 8, 8, 8, 7, 7];
            let mZ = (d < termDays[m]) ? (m === 1 ? 11 : m) : (m % 12) + 1;
            if (m === 1 && d >= termDays[1]) mZ = 1; else if (m === 2 && d >= termDays[2]) mZ = 2; else if (d >= termDays[m]) mZ = m;
            const mG = (((yG % 10 % 5) * 2 + 2 + (mZ + 10) % 12) % 10);

            const dIdx = (Math.floor((new Date(dateStr).getTime() - new Date('1900-01-01').getTime()) / 86400000) + 10) % 60;
            const dG = dIdx % 10, dZ = dIdx % 12;

            const hZ = Math.floor(((hour + 1) % 24) / 2);
            const hG = (((dG % 5) * 2 + hZ) % 10);

            // Render Pillars: Hour, Day, Month, Year
            document.getElementById('hP').innerHTML = getPillarHtml(hG, hZ);
            document.getElementById('dP').innerHTML = getPillarHtml(dG, dZ);
            document.getElementById('mP').innerHTML = getPillarHtml(mG, mZ);
            document.getElementById('yP').innerHTML = getPillarHtml(yG, yZ);

            // Show pillar display area
            document.getElementById('pillarDisplay').classList.remove('hidden');

            const resultArea = document.getElementById('resultArea');
            resultArea.classList.remove('hidden');

            const counts = { Wood: 0, Fire: 0, Earth: 0, Metal: 0, Water: 0 };
            [GAN_EL[yG], ZHI_EL[yZ], GAN_EL[mG], ZHI_EL[mZ], GAN_EL[dG], ZHI_EL[dZ], GAN_EL[hG], ZHI_EL[hZ]].forEach(el => counts[el]++);
            document.getElementById('elementCounts').innerHTML = highlightKeywords(`<span>WOOD: ${counts.Wood}</span><span>FIRE: ${counts.Fire}</span><span>EARTH: ${counts.Earth}</span><span>METAL: ${counts.Metal}</span><span>WATER: ${counts.Water}</span>`);

            // Advanced Yongsin Logic
            function calculateAdvancedYongsin(counts) {
                // 1. Check for Dominant Element (>=4) -> Must Drain (Child)
                const els = ["Wood", "Fire", "Earth", "Metal", "Water"];
                let maxEl = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);

                // Map of Child elements (To Drain)
                const childMap = { "Wood": "Fire", "Fire": "Earth", "Earth": "Metal", "Metal": "Water", "Water": "Wood" };

                if (counts[maxEl] >= 4) {
                    return childMap[maxEl];
                }

                // 2. Missing Element (0 Count) - Priority
                let missing = els.filter(el => counts[el] === 0);
                if (missing.length > 0) {
                    for (let mEl of missing) {
                        // Safety Check: Is it attacked by a Strong Element (>=3)?
                        const attackerMap = { "Wood": "Metal", "Fire": "Water", "Earth": "Wood", "Metal": "Fire", "Water": "Earth" };
                        const attacker = attackerMap[mEl];

                        // If Attacker is Strong (>=3), recommend Bridge (Mother) instead.
                        if (counts[attacker] >= 3) {
                            const motherMap = { "Wood": "Water", "Fire": "Wood", "Earth": "Fire", "Metal": "Earth", "Water": "Metal" };
                            return motherMap[mEl];
                        }
                    }
                    return missing[0];
                }

                // 3. Tong-gwan (Bridge) Logic for Clashes (Attacker >= 3 vs Victim <= 1)
                // Metal vs Wood -> Water
                if (counts.Metal >= 3 && counts.Wood <= 1) return "Water";
                // Water vs Fire -> Wood
                if (counts.Water >= 3 && counts.Fire <= 1) return "Wood";
                // Wood vs Earth -> Fire
                if (counts.Wood >= 3 && counts.Earth <= 1) return "Fire";
                // Fire vs Metal -> Earth
                if (counts.Fire >= 3 && counts.Metal <= 1) return "Earth";
                // Earth vs Water -> Metal
                if (counts.Earth >= 3 && counts.Water <= 1) return "Metal";

                // 4. Fallback: Simplest Deficiency (Standard Balance)
                // Find all elements with the minimum count
                let minCount = Math.min(...Object.values(counts));
                let candidates = els.filter(el => counts[el] === minCount);

                // Tie-breaker: If mixed, prioritize 'Water' or 'Fire' for temperature balance (Jo-hoo), 
                // but for simplicity, return the first one found or random. 
                // Using first one ensures deterministic result.
                return candidates[0];
            }

            let yongSin = calculateAdvancedYongsin(counts);

            // --- Dynamic Theme Coloring ---
            // Reset common bg classes
            resultArea.className = "mt-8 w-full animate-in fade-in zoom-in duration-500 rounded-[50px] p-8 md:p-12 text-white relative shadow-2xl overflow-hidden min-h-[600px] flex flex-col justify-center transform transition-colors duration-1000";
            // Apply new dynamic class
            resultArea.classList.add(THEME_COLORS[yongSin].bg);

            const amazonTag = "ricecakeusa-20";
            const teaData = {
                Wood: {
                    teas: [
                        { name: "Green Tea", desc: "Your chart lacks Wood (Growth Energy). Without it, you may feel stagnant or uninspired. Green Tea provides the vital antioxidants and fresh energy needed to jumpstart your metabolism and creativity.", query: "Premium+Green+Tea" },
                        { name: "Peppermint Tea", desc: "Deficient Wood can lead to tension and liver stress. Peppermint naturally relaxes smooth muscles and clears the mind, simulating the free-flowing nature of Wood energy you are missing.", query: "Organic+Peppermint+Tea" }
                    ],
                    toolQuery: "Bamboo+Tea+Tray+Set"
                },
                Fire: {
                    teas: [
                        { name: "Black Tea (Earl Grey)", desc: "A lack of Fire (Passion Energy) can result in low circulation or cold hands/feet. The fermentation in Black Tea creates warming properties that physically heat the body and stimulate the heart.", query: "Earl+Grey+Black+Tea" },
                        { name: "Rooibos Tea", desc: "Missing Fire energy often means low vitality. Rooibos is rich in minerals and electrolytes, acting as a caffeine-free battery recharger to restore your natural warmth and radiance.", query: "Organic+Rooibos+Tea" }
                    ],
                    toolQuery: "Glass+Teapot+with+Warmer"
                },
                Earth: {
                    teas: [
                        { name: "Chamomile Tea", desc: "Weak Earth energy manifests as digestive issues or worry. Chamomile is scientifically proven to soothe the gut-brain axis, providing the grounding stability your body currently lacks.", query: "Organic+Chamomile+Tea" },
                        { name: "Barley / Corn Silk Tea", desc: "Without Earth (Stability), you may feel ungrounded. These grain-based teas provide essential minerals and a comforting, neutral energy that settles the stomach and reinforces your physical center.", query: "Roasted+Barley+Tea" }
                    ],
                    toolQuery: "Ceramic+Tea+Mug+Set"
                },
                Metal: {
                    teas: [
                        { name: "Ginger Tea", desc: "A deficiency in Metal (Structure) can weaken the lungs and immune defense. Ginger's pungency warms the lungs and boosts immunity, acting as a protective shield for your system.", query: "Organic+Ginger+Tea" },
                        { name: "White Tea", desc: "Lacking Metal energy can make you feel cluttered or overwhelmed. White Tea is the least processed, offering pure, high-potency antioxidants that help detoxify and refine your mental clarity.", query: "Premium+White+Tea" }
                    ],
                    toolQuery: "White+Porcelain+Tea+Set"
                },
                Water: {
                    teas: [
                        { name: "Black Soybean Tea", desc: "Water energy corresponds to the Kidneys and the color Black. Black Soybeans are the premier 'Black Food' in Oriental medicine, famous for replenishing vital essence (Jing) and preventing aging.", query: "Black+Soybean+Tea" },
                        { name: "Pu-erh Tea", desc: "Deficient Water energy leads to dryness and burnout. Pu-erh is a fermented, living tea that supports deep hydration and gut health, restoring the deep reserves of wisdom and stamina you need.", query: "Aged+Puerh+Tea" }
                    ],
                    toolQuery: "Yixing+Clay+Teapot"
                }
            };

            const result = teaData[yongSin];
            const targetElDiv = document.getElementById('targetElement');
            targetElDiv.innerHTML = `<span class="px-6 py-2 rounded-full ${THEME_COLORS[yongSin].badge} text-white shadow-md inline-block mb-2 font-bold">${yongSin} Energy</span>`;

            // Render 2 Teas
            document.getElementById('tea1Name').innerText = "1. " + result.teas[0].name;
            document.getElementById('tea1Desc').innerHTML = highlightKeywords(result.teas[0].desc);
            document.getElementById('tea1Link').href = `https://www.amazon.com/s?k=${result.teas[0].query}&tag=${amazonTag}`;

            document.getElementById('tea2Name').innerText = "2. " + result.teas[1].name;
            document.getElementById('tea2Desc').innerHTML = highlightKeywords(result.teas[1].desc);
            document.getElementById('tea2Link').href = `https://www.amazon.com/s?k=${result.teas[1].query}&tag=${amazonTag}`;

            // Lifestyle Tip
            document.getElementById('lifestyleTip').innerHTML = highlightKeywords(`Boost your vitality by keeping <b>${ELEMENT_COLOR_NAME[yongSin]}</b> close to you. Setting your <b>phone wallpaper</b> to ${ELEMENT_WALLPAPER_DESC[yongSin]} or wearing <b>${ELEMENT_COLOR_NAME[yongSin]} clothes</b> can act as a daily habit to balance your deficient energy.`);

            // Tools Button
            document.getElementById('toolLink').href = `https://www.amazon.com/s?k=${result.toolQuery}&tag=${amazonTag}`;
            document.getElementById('toolLink').innerText = `Shop ${yongSin} Ritual Tools ‚Üí`;

            const dstMsg = applyCorrection ? " w/ DST Correction" : "";
            document.getElementById('analysisDesc').innerHTML = `Your energy profile shows a need for <b class="${THEME_COLORS[yongSin].accent}">${yongSin}</b>. We have selected teas and colors to fill this gap and restore harmony.`;

            // --- Enable General Analysis ---
            const genData = getGenAnalysis(dG, dZ, yG, mG, hG, counts);
            document.getElementById('genPersonality').innerHTML = genData.personality;
            document.getElementById('genWealth').innerHTML = genData.wealth;
            document.getElementById('genYear').innerHTML = genData.yearDesc;
            document.getElementById('genMonth').innerHTML = genData.monthDesc;
            document.getElementById('genDay').innerHTML = genData.dayDesc;
            document.getElementById('genHour').innerHTML = genData.hourDesc;

            document.getElementById('genAnalysisArea').classList.remove('hidden');

            window.scrollTo({ top: document.getElementById('resultArea').offsetTop - 20, behavior: 'smooth' });
        }
    </script>
</body>

</html>
